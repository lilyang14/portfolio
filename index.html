<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI设计作品集</title>
    <!-- 网站图标配置 -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
    <link rel="manifest" href="favicon_io/site.webmanifest">
    <style>
        /* 全局样式重置与基础设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1C1C1C;
            padding-top: 60px;
            overflow-x: hidden;
        }

        /* 图片容器样式 */
        .image-container {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        /* 图片样式 - 响应式设计 */
        .work-image {
            width: 100%;
            height: auto;
            display: block;
        }

        /* 骨架屏样式 */
        .skeleton {
            width: 100%;
            height: 1080px;
            background-color: rgba(255, 255, 255, 0.2);
            display: block;
        }

        /* 网络异常提示样式 */
        .error-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 100;
        }

        .error-message {
            color: #FFFFFF;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .reload-btn {
            width: 96px;
            height: 36px;
            background-color: rgba(255, 255, 255, 0.2);
            color: #FFFFFF;
            border: none;
            border-radius: 2px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .reload-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* 桌面端适配 */
        @media (min-width: 768px) {
            .image-container {
                align-items: center;
            }

            .work-image, .skeleton {
                width: 65%;
                max-width: 1200px;
            }
        }

        /* 隐藏错误提示默认状态 */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="image-container" id="imageContainer"></div>
    <div class="error-container hidden" id="errorContainer">
        <div class="error-message">网络异常，请重新加载</div>
        <button class="reload-btn" id="reloadBtn">重新加载</button>
    </div>

    <script>
        // 全局变量
        const imageContainer = document.getElementById('imageContainer');
        const errorContainer = document.getElementById('errorContainer');
        const reloadBtn = document.getElementById('reloadBtn');
        let currentImageIndex = 1;
        let isLoading = false;
        let hasMoreImages = true;
        const batchSize = 3; // 每次加载3张图片

        // 页面加载时滚动到顶部
        window.addEventListener('load', () => {
            window.scrollTo(0, 0);
        });

        // 禁止右键菜单和图片拖拽
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('dragstart', (e) => {
            if (e.target.tagName === 'IMG') e.preventDefault();
        });

        // 初始加载图片
        loadImages();

        // 滚动加载更多图片
        window.addEventListener('scroll', () => {
            if (hasMoreImages && !isLoading && 
                window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                loadImages();
            }
        });

        // 重新加载按钮事件
        reloadBtn.addEventListener('click', () => {
            errorContainer.classList.add('hidden');
            currentImageIndex = 1;
            hasMoreImages = true;
            imageContainer.innerHTML = '';
            loadImages();
        });

        // 加载图片函数
        async function loadImages() {
            if (!hasMoreImages || isLoading) return;
            
            isLoading = true;
            let loadFailed = false;

            // 添加骨架屏
            for (let i = 0; i < batchSize; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'skeleton';
                skeleton.id = `skeleton-${currentImageIndex + i}`;
                imageContainer.appendChild(skeleton);
            }

            try {
                // 批量加载图片
                const loadPromises = [];
                for (let i = 0; i < batchSize; i++) {
                    const imageIndex = currentImageIndex + i;
                    loadPromises.push(loadSingleImage(imageIndex));
                }

                const results = await Promise.allSettled(loadPromises);
                
                // 检查是否所有图片都加载失败
                const failedCount = results.filter(res => res.status === 'rejected').length;
                if (failedCount === batchSize) {
                    hasMoreImages = false;
                    // 如果是第一次加载就失败，显示错误提示
                    if (currentImageIndex === 1) {
                        showError();
                    }
                }

                currentImageIndex += batchSize;
            } catch (error) {
                showError();
            } finally {
                isLoading = false;
            }
        }

        // 加载单张图片
        async function loadSingleImage(index) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = `images/work${index}.png`;
                img.className = 'work-image';
                img.alt = `设计作品 ${index}`;

                // 图片加载成功
                img.onload = () => {
                    const skeleton = document.getElementById(`skeleton-${index}`);
                    if (skeleton) {
                        skeleton.replaceWith(img);
                    } else {
                        imageContainer.appendChild(img);
                    }
                    resolve(index);
                };

                // 图片加载失败
                img.onerror = () => {
                    const skeleton = document.getElementById(`skeleton-${index}`);
                    if (skeleton) skeleton.remove();
                    reject(index);
                };

                // 超时处理（5秒）
                setTimeout(() => {
                    reject(new Error(`图片加载超时: work${index}.png`));
                }, 5000);
            });
        }

        // 显示网络错误提示
        function showError() {
            errorContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>
